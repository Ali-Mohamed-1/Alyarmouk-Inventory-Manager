@model Inventory.Application.DTOs.SalesOrder.SalesOrderResponseDto
@{
    ViewData["Title"] = $"Order {Model.OrderNumber}";
}

<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h2 mb-0">Order <span class="text-primary">@Model.OrderNumber</span></h1>
            <p class="text-muted mb-0">Created on @Model.CreatedUtc.ToString("f")</p>
        </div>
        <div>
            <a asp-action="Index" class="btn btn-outline-secondary me-2">Back to List</a>
            <button class="btn btn-primary" onclick="window.print()">Print Order</button>
        </div>
    </div>

    <div class="row">
        <!-- Main Info -->
        <div class="col-lg-8">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">Order Items</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light text-muted small text-uppercase">
                                <tr>
                                    <th>Product</th>
                                    <th>Batch</th>
                                    <th class="text-center">Quantity</th>
                                    <th class="text-end">Unit Price</th>
                                    <th class="text-end">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var line in Model.Lines)
                                {
                                    <tr>
                                        <td>
                                            <div class="fw-bold">@line.ProductName</div>
                                            <div class="small text-muted">@line.Unit</div>
                                        </td>
                                        <td>
                                            @if (!string.IsNullOrEmpty(line.BatchNumber))
                                            {
                                                <span class="badge bg-light text-dark border">@line.BatchNumber</span>
                                            }
                                            else
                                            {
                                                <span class="text-muted small">-</span>
                                            }
                                        </td>
                                        <td class="text-center">@line.Quantity</td>
                                        <td class="text-end">@line.UnitPrice.ToString("C2")</td>
                                        <td class="text-end fw-bold">@line.LineTotal.ToString("C2")</td>
                                    </tr>
                                }
                            </tbody>
                            <tfoot class="border-top-0">
                                <tr>
                                    <td colspan="4" class="text-end text-muted">Subtotal</td>
                                    <td class="text-end">@Model.Subtotal.ToString("C2")</td>
                                </tr>
                                @if (Model.ApplyVat)
                                {
                                    <tr>
                                        <td colspan="4" class="text-end text-muted">VAT (14%)</td>
                                        <td class="text-end">@Model.VatAmount.ToString("C2")</td>
                                    </tr>
                                }
                                @if (Model.ApplyManufacturingTax)
                                {
                                    <tr>
                                        <td colspan="4" class="text-end text-muted">Manufacturing Tax (1%)</td>
                                        <td class="text-end text-danger">-@Model.ManufacturingTaxAmount.ToString("C2")</td>
                                    </tr>
                                }
                                <tr class="table-light">
                                    <td colspan="4" class="text-end fw-bold fs-5">Total Amount</td>
                                    <td class="text-end fw-bold fs-5 text-success">@Model.TotalAmount.ToString("C2")</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>

            @if (!string.IsNullOrEmpty(Model.Note))
            {
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-light">
                        <h5 class="card-title mb-0">Notes</h5>
                    </div>
                    <div class="card-body">
                        <p class="mb-0">@Model.Note</p>
                    </div>
                </div>
            }
        </div>

        <!-- Sidebar Info -->
        <div class="col-lg-4">
            <!-- Customer Info -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">Customer Information</h5>
                </div>
                <div class="card-body">
                    <h6 class="mb-1">@Model.CustomerName</h6>
                    <p class="small text-muted mb-0">Customer ID: #@Model.CustomerId</p>
                </div>
            </div>

            <!-- Status Info -->
            <div class="card shadow-sm mb-4 border-start border-4 @(Model.Status == Inventory.Domain.Entities.SalesOrderStatus.Completed ? "border-success" : "border-info")">
                <div class="card-body">
                    <h6 class="text-muted text-uppercase small fw-bold mb-3">Order Status</h6>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="badge @(Model.Status == Inventory.Domain.Entities.SalesOrderStatus.Completed ? "bg-success" : "bg-info") fs-6">
                            @Model.Status
                        </span>
                        <span class="text-muted small">Updated: @Model.CreatedUtc.ToString("g")</span>
                    </div>
                </div>
            </div>

            <!-- Payment Info -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">Payment Details</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3 text-center">
                        <span class="badge @(Model.PaymentStatus == Inventory.Domain.Entities.PaymentStatus.Paid ? "bg-success" : "bg-warning") w-100 py-2 fs-6">
                            @Model.PaymentStatus
                        </span>
                    </div>
                    <div class="row g-2">
                        <div class="col-6 text-muted small">Method:</div>
                        <div class="col-6 text-end fw-bold">@Model.PaymentMethod</div>

                        <div class="col-6 text-muted small">Due Date:</div>
                        <div class="col-6 text-end">@Model.DueDate.ToString("d")</div>

                        @if (Model.PaymentMethod == Inventory.Domain.Entities.PaymentMethod.Check)
                        {
                            <div class="col-12 mt-3 pt-2 border-top">
                                <h6 class="small fw-bold text-uppercase text-muted">Check Details</h6>
                                <div class="d-flex justify-content-between small mb-1">
                                    <span>Received:</span>
                                    <span>@(Model.CheckReceived == true ? "Yes" : "No")</span>
                                </div>
                                <div class="d-flex justify-content-between small mb-1">
                                    <span>Cashed:</span>
                                    <span>@(Model.CheckCashed == true ? "Yes" : "No")</span>
                                </div>
                            </div>
                        }
                        else if (Model.PaymentMethod == Inventory.Domain.Entities.PaymentMethod.BankTransfer)
                        {
                            <div class="col-12 mt-3 pt-2 border-top">
                                <h6 class="small fw-bold text-uppercase text-muted">Bank Transfer Details</h6>
                                <div class="d-flex justify-content-between small mb-1">
                                    <span>Transfer ID:</span>
                                    <span class="fw-bold">@(Model.TransferId ?? "N/A")</span>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Documents -->
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">Documents</h5>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        @if (!string.IsNullOrEmpty(Model.InvoicePath))
                        {
                            <a href="@Model.InvoicePath" target="_blank" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="bi bi-file-earmark-pdf text-danger me-2"></i> Invoice
                                </div>
                                <i class="bi bi-download"></i>
                            </a>
                        }
                        @if (!string.IsNullOrEmpty(Model.ReceiptPath))
                        {
                            <a href="@Model.ReceiptPath" target="_blank" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="bi bi-file-earmark-check text-success me-2"></i> Receipt
                                </div>
                                <i class="bi bi-download"></i>
                            </a>
                        }
                    </div>
                    @if (string.IsNullOrEmpty(Model.InvoicePath) && string.IsNullOrEmpty(Model.ReceiptPath))
                    {
                        <div class="p-3 text-center text-muted small italic">No documents attached</div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
